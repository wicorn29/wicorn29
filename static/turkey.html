<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wicorn29 - Turkey</title>
    <link rel="stylesheet" href="../global.css">
</head>
<body>

    <div class="window" id="ip-window">
        <div class="window-header">Your IP Address</div>
        <div class="window-body">
            <p>In case you didn’t know, here’s your IP address:</p>
            <div id="ip" style="font-weight: bold; font-size: 20px;">Loading...</div>
            <p>(You learn something new every day!)</p>
        </div>
    </div>

    <div class="window" id="services-window">
        <div class="window-header">
            <span>Services</span>
            <div class="close-button" onclick="closeServices()">r</div>
        </div>
        <div class="window-body">
            <ul class="tree-view" id="services-tree"></ul>
        </div>
    </div>

    <div id="start-bar">
        <div id="start-button" onclick="openServices()"><b>Services</b></div>
        <a href="/" id="start-button" style="margin-left: 5px; text-decoration: none;">Home</a>
    </div>

  <script>
    function openServices() {
        document.getElementById('services-window').style.display = 'block';
    }

    function closeServices() {
        document.getElementById('services-window').style.display = 'none';
    }

    fetch('https://api.ipify.org?format=json')
      .then(response => response.json())
      .then(data => {
        document.getElementById('ip').textContent = data.ip;
      });

    fetch('../ddat/services.json')
        .then(response => response.json())
        .then(data => {
            const servicesTree = document.getElementById('services-tree');

            data.forEach(service => {
                if (service.visible) {
                    const serviceItem = document.createElement('li');
                    const serviceLink = document.createElement('a');
                    serviceLink.href = service.url;
                    serviceLink.target = '_blank';
                    
                    const img = document.createElement('img');
                    img.src = `https://www.google.com/s2/favicons?domain=${service.url}`;
                    img.alt = service.name;
                    img.style.width = '16px';
                    img.style.height = '16px';
                    img.style.marginRight = '5px';

                    serviceLink.appendChild(img);
                    serviceLink.appendChild(document.createTextNode(service.name));
                    serviceItem.appendChild(serviceLink);

                    if (service.subs && service.subs.length > 0) {
                        const subList = document.createElement('ul');
                        subList.classList.add('tree-view');
                        service.subs.forEach(sub => {
                            if (sub.visible) {
                                const subItem = document.createElement('li');
                                const subLink = document.createElement('a');
                                subLink.href = sub.url;
                                subLink.target = '_blank';

                                const subImg = document.createElement('img');
                                subImg.src = `https://www.google.com/s2/favicons?domain=${sub.url}`;
                                subImg.alt = sub.name;
                                subImg.style.width = '16px';
                                subImg.style.height = '16px';
                                subImg.style.marginRight = '5px';

                                subLink.appendChild(subImg);
                                subLink.appendChild(document.createTextNode(sub.name));
                                subItem.appendChild(subLink);
                                subList.appendChild(subItem);
                            }
                        });
                        serviceItem.appendChild(subList);
                    }
                    servicesTree.appendChild(serviceItem);
                }
            });
        });
  </script>
</body>
</html>