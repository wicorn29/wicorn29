<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wicorn29</title>
    <link rel="stylesheet" href="global.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>

    <div class="window" id="readme-window">
        <div class="window-header">README.md</div>
        <div class="window-body" id="readme-content"></div>
    </div>

    <div class="window" id="services-window">
        <div class="window-header">
            <span>Services</span>
            <div class="close-button" onclick="closeServices()">r</div>
        </div>
        <div class="window-body">
            <ul class="tree-view" id="services-tree"></ul>
        </div>
    </div>

    <div id="start-bar">
        <div id="start-button" onclick="openServices()"><b>Services</b></div>
    </div>

    <script>
        function openServices() {
            document.getElementById('services-window').style.display = 'block';
        }

        function closeServices() {
            document.getElementById('services-window').style.display = 'none';
        }

        fetch('README.md')
            .then(response => response.text())
            .then(text => {
                // Populate main content window
                document.getElementById('readme-content').innerHTML = marked.parse(text);

                // Populate services menu from ## Services section
                const servicesTree = document.getElementById('services-tree');
                const servicesSection = text.split('\n## Services\n')[1];
                let currentMainService = null;

                if (servicesSection) {
                    const lines = servicesSection.split('\n');
                    lines.forEach(line => {
                        const isSubItem = line.startsWith('  ') || line.startsWith('\t');
                        const trimmedLine = line.trim();

                        if (trimmedLine.startsWith('- ')) {
                            const match = trimmedLine.match(/- \[(.+)\]\((.+)\)/);
                            if (match) {
                                const name = match[1];
                                const url = match[2];

                                const listItem = document.createElement('li');
                                const link = document.createElement('a');
                                link.href = url;
                                link.target = '_blank';

                                const img = document.createElement('img');
                                img.src = `https://www.google.com/s2/favicons?domain=${url}`;
                                img.alt = name;
                                img.style.width = '16px';
                                img.style.height = '16px';
                                img.style.marginRight = '5px';

                                link.appendChild(img);
                                link.appendChild(document.createTextNode(` ${name}`));
                                listItem.appendChild(link);

                                if (isSubItem && currentMainService) {
                                    let subList = currentMainService.querySelector('ul');
                                    if (!subList) {
                                        subList = document.createElement('ul');
                                        subList.classList.add('tree-view');
                                        currentMainService.appendChild(subList);
                                    }
                                    subList.appendChild(listItem);
                                } else if (!isSubItem) {
                                    servicesTree.appendChild(listItem);
                                    currentMainService = listItem;
                                }
                            }
                        }
                    });
                }
            });
    </script>

</body>
</html>