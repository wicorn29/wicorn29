<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wicorn29</title>
    <link rel="stylesheet" href="global.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>

    <div id="desktop">
        <!-- Content is generated here -->
    </div>

    <div class="window" id="services-window">
        <div class="window-header">
            <span>Services</span>
            <div class="close-button" onclick="closeServices()">r</div>
        </div>
        <div class="window-body">
            <ul class="tree-view" id="services-tree"></ul>
        </div>
    </div>

    <div id="start-bar">
        <div id="start-button" onclick="openServices()"><b>Services</b></div>
    </div>

    <script>
        function openServices() {
            document.getElementById('services-window').style.display = 'block';
        }

        function closeServices() {
            document.getElementById('services-window').style.display = 'none';
        }

        function createWindow(title, contentHTML) {
            const windowDiv = document.createElement('div');
            windowDiv.className = 'window';

            const headerDiv = document.createElement('div');
            headerDiv.className = 'window-header';
            headerDiv.textContent = title;

            const bodyDiv = document.createElement('div');
            bodyDiv.className = 'window-body';
            bodyDiv.innerHTML = contentHTML;

            windowDiv.appendChild(headerDiv);
            windowDiv.appendChild(bodyDiv);
            return windowDiv;
        }

        fetch('README.md')
            .then(response => response.text())
            .then(text => {
                const desktop = document.getElementById('desktop');
                const sections = text.split('\n## ');
                
                const aboutContent = sections.shift().replace(/^#\s.*\n/, '');
                desktop.appendChild(createWindow('About Me', marked.parse(aboutContent)));

                sections.forEach(section => {
                    const endOfTitle = section.indexOf('\n');
                    let title = section.substring(0, endOfTitle).trim();
                    const content = section.substring(endOfTitle).trim();

                    if (title.toLowerCase() === 'stuff i do not know' || title.toLowerCase() === 'website') {
                        return; // Skip these sections
                    }
                    
                    if (title.toLowerCase() === 'stuff i know') {
                        title = 'crap i know';
                    }

                    desktop.appendChild(createWindow(title, marked.parse(content)));
                });
            });


        fetch('ddat/services.json')
            .then(response => response.json())
            .then(data => {
                const servicesTree = document.getElementById('services-tree');

                data.forEach(service => {
                    if (service.visible) {
                        const serviceItem = document.createElement('li');
                        const serviceLink = document.createElement('a');
                        serviceLink.href = service.url;
                        serviceLink.target = '_blank';
                        
                        const img = document.createElement('img');
                        img.src = `https://www.google.com/s2/favicons?domain=${service.url}`;
                        img.alt = service.name;
                        img.style.width = '16px';
                        img.style.height = '16px';
                        img.style.marginRight = '5px';

                        serviceLink.appendChild(img);
                        serviceLink.appendChild(document.createTextNode(service.name));
                        serviceItem.appendChild(serviceLink);

                        if (service.subs && service.subs.length > 0) {
                            const subList = document.createElement('ul');
                            subList.classList.add('tree-view');
                            service.subs.forEach(sub => {
                                if (sub.visible) {
                                    const subItem = document.createElement('li');
                                    const subLink = document.createElement('a');
                                    subLink.href = sub.url;
                                    subLink.target = '_blank';

                                    const subImg = document.createElement('img');
                                    subImg.src = `https://www.google.com/s2/favicons?domain=${sub.url}`;
                                    subImg.alt = sub.name;
                                    subImg.style.width = '16px';
                                    subImg.style.height = '16px';
                                    subImg.style.marginRight = '5px';

                                    subLink.appendChild(subImg);
                                    subLink.appendChild(document.createTextNode(sub.name));
                                    subItem.appendChild(subLink);
                                    subList.appendChild(subItem);
                                }
                            });
                            serviceItem.appendChild(subList);
                        }
                        servicesTree.appendChild(serviceItem);
                    }
                });
            });
    </script>

</body>
</html>